{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Manoa\\\\Desktop\\\\ionic1\\\\src\\\\pages\\\\InsertSignilement.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { IonHeader, IonPage, IonToolbar, IonTitle, IonContent, IonItem, IonLabel, IonInput, IonButton, IonMenuButton, IonSelect, IonSelectOption, IonTextarea, IonGrid, IonRow, IonCol, IonImg, IonActionSheet, IonFab, IonFabButton, IonIcon } from \"@ionic/react\";\nimport { RemoteService } from \"../services/remote.service\";\nimport axios from 'axios';\nimport { Geolocation } from '@capacitor/geolocation';\nimport { usePhotoGallery } from '../hooks/usePhotoGallery';\nimport { camera, trash, close } from 'ionicons/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\n// console.log('Current', coordinates);\nconst InsertSignilement = _ref => {\n  _s();\n\n  let {\n    history\n  } = _ref;\n  const remoteService = new RemoteService();\n  const [error, setError] = useState({\n    error: false\n  });\n  const loginForm = useRef(null);\n  const [lType, setLType] = useState([]);\n  const [lon, setLon] = useState(Number);\n  const [lat, setLat] = useState(Number);\n  const geolocation = Geolocation;\n  const {\n    photos,\n    takePhoto\n  } = usePhotoGallery();\n  const {\n    deletePhoto\n  } = usePhotoGallery();\n  const [photoToDelete, setPhotoToDelete] = useState();\n  const [tabProblem, setTabProblem] = useState([]);\n  let id = \"\";\n  const [region, setRegion] = useState(\"null\");\n  const [utilisateur, setUtilisateur] = useState(sessionStorage.getItem(\"id\"));\n  const [tokenn, settoken] = useState(sessionStorage.getItem(\"Token\"));\n  const [objet, setObjet] = useState(\"\");\n  const current = new Date();\n  const [datesignalement, setDateSignalement] = useState(\"2022-02-25\");\n  const [type, setTypee] = useState(\"PRO1\");\n  const [protocole, setProtocole] = useState(\"PRO1\");\n  const [description, setDescription] = useState(\"\");\n  const [longitude, setLongitude] = useState(lon);\n  const [latitude, setLatitude] = useState(lat); // console.log(sessionStorage.getItem(\"id\"));\n\n  const sendGetRequest = async () => {\n    return axios({\n      url: 'http://localhost:3011/types',\n      method: 'GET'\n    }).then(Response => {\n      return Response.data;\n    }).catch(error => {\n      console.log('Error get type', error);\n    });\n  };\n\n  useEffect(() => {\n    sendGetRequest().then(data => setLType(data));\n  });\n\n  const getLocation = () => {\n    geolocation.getCurrentPosition().then(Resp => {\n      setLon(Resp.coords.longitude);\n      setLat(Resp.coords.latitude);\n      console.log(`${Resp.coords.latitude},${Resp.coords.longitude}`);\n    }).catch(error => {\n      console.log('No connection default location', error);\n      setLon(-18.9860485);\n      setLat(47.5324514);\n      setLongitude(-18.9860485);\n      setLatitude(47.5324514);\n    });\n    console.log(`${lat},${lon}`);\n  };\n\n  const Valider = async () => {\n    getLocation();\n    setLatitude(lat);\n    setLongitude(lon);\n    id = \"SIG\" + 203; //(Math.floor(Math.random() * (5000 - 101 + 1)) + 101).toString();\n\n    console.log(id + \"-\" + type + \"-\" + region + \"-\" + utilisateur + \"-\" + objet + \"-\" + datesignalement + \"-\" + protocole + \"-\" + description + \"-\" + longitude + \"-\" + latitude);\n    axios.post(\"http://localhost:3011/signalements/objet/\" + tokenn, {\n      id,\n      type,\n      region,\n      utilisateur,\n      objet,\n      datesignalement,\n      protocole,\n      description,\n      longitude,\n      latitude\n    }).then(res => {// console.log(\"UT\"+(Math.floor(Math.random()*(11 -0 +1))+10).toString())\n      // setSuccess(\"inscription terminée\");\n      //window.location.href = \"/login\";\n    }).catch(error => console.log(error));\n    var cp = [];\n\n    for (var i = 0; i < photos.length; i++) {\n      var b = await (await fetch(photos[i].webviewPath)).blob();\n      cp.push(b);\n    }\n\n    var formData = new FormData();\n\n    for (var i = 0; i < cp.length; i++) {\n      formData.append('files', cp[i], \"photo.jpeg\");\n    }\n\n    var url = \"http://localhost:3011//upload/image\";\n    fetch(url, {\n      method: 'POST',\n      body: formData\n    });\n  };\n\n  const envoyer = async () => {//   var cp=[];\n    //   for(var i=0;i<photos.length;i++){\n    //     var b=await (await fetch(photos[i].webviewPath!)).blob();\n    //     cp.push(b);\n    //   }\n    //   var formData = new FormData()\n    //   for(var i=0;i<cp.length;i++){\n    //   formData.append('files',cp[i],\"photo.jpeg\");\n    //  }\n    //   formData.append('problem', prob)\n    //   formData.append('description', descri)\n    //   formData.append('coordonneX', \"\" + lat)\n    //   formData.append('coordonneY', \"\" + long)\n    //   var url = \"http://localhost:6565/api/ajout/signalement/photos/\"+localStorage.getItem('token')\n    //   fetch(url, {\n    //     method: 'POST',\n    //     body: formData,\n    //   })\n    //     .then((res) => res.json())\n    //     .then((result) => {\n    //       setMessage(\"Envoye du signalement réussie\");\n    //     })\n    //     .catch((error) => {\n    //       setErreur(\"Echec de l'envoye\");\n    //     });\n  };\n\n  return /*#__PURE__*/_jsxDEV(IonPage, {\n    children: [/*#__PURE__*/_jsxDEV(IonHeader, {\n      children: /*#__PURE__*/_jsxDEV(IonToolbar, {\n        children: [/*#__PURE__*/_jsxDEV(IonMenuButton, {\n          slot: \"start\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(IonTitle, {\n          children: \"Nouveau signilement\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(IonContent, {\n      children: [/*#__PURE__*/_jsxDEV(IonItem, {\n        children: [/*#__PURE__*/_jsxDEV(IonLabel, {\n          position: \"floating\",\n          children: \"Object\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(IonInput, {\n          placeholder: \"\",\n          type: \"text\",\n          name: \"Object\",\n          id: \"Object\",\n          onIonChange: e => setObjet(e.detail.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(IonGrid, {\n        children: /*#__PURE__*/_jsxDEV(IonRow, {\n          children: photos.map((photo, index) => /*#__PURE__*/_jsxDEV(IonCol, {\n            size: \"6\",\n            children: /*#__PURE__*/_jsxDEV(IonImg, {\n              onClick: () => setPhotoToDelete(photo),\n              src: photo.webviewPath\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 208,\n              columnNumber: 19\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(IonFab, {\n        vertical: \"bottom\",\n        horizontal: \"center\",\n        slot: \"fixed\",\n        children: /*#__PURE__*/_jsxDEV(IonFabButton, {\n          onClick: () => takePhoto(),\n          children: /*#__PURE__*/_jsxDEV(IonIcon, {\n            icon: camera\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(IonActionSheet, {\n        isOpen: !!photoToDelete,\n        buttons: [{\n          text: 'Delete',\n          role: 'destructive',\n          icon: trash,\n          handler: () => {\n            if (photoToDelete) {\n              deletePhoto(photoToDelete);\n              setPhotoToDelete(undefined);\n            }\n          }\n        }, {\n          text: 'Cancel',\n          icon: close,\n          role: 'cancel'\n        }],\n        onDidDismiss: () => setPhotoToDelete(undefined)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(IonItem, {\n        children: [/*#__PURE__*/_jsxDEV(IonLabel, {\n          position: \"floating\",\n          children: \"Type\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(IonSelect, {\n          placeholder: \"Choisissez le type d'incidents\",\n          name: \"type\",\n          id: \"type\",\n          onIonChange: e => setTypee(e.detail.value),\n          children: lType.map((el, index) => {\n            return /*#__PURE__*/_jsxDEV(IonSelectOption, {\n              value: el['id'],\n              children: el['nom']\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 27\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(IonItem, {\n        children: [/*#__PURE__*/_jsxDEV(IonLabel, {\n          position: \"floating\",\n          children: \"description\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 258,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(IonTextarea, {\n          name: \"description\",\n          id: \"description\",\n          onIonChange: e => setDescription(e.detail.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"button-wrapper\",\n        children: /*#__PURE__*/_jsxDEV(IonButton, {\n          expand: \"block\",\n          onClick: () => Valider(),\n          children: \"Valider\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 183,\n    columnNumber: 5\n  }, this);\n}; // export default Details;\n\n\n_s(InsertSignilement, \"jm7OS2nAJhy+U15lmU4ivV1ksDU=\", false, function () {\n  return [usePhotoGallery, usePhotoGallery];\n});\n\n_c = InsertSignilement;\nexport default InsertSignilement;\n\nvar _c;\n\n$RefreshReg$(_c, \"InsertSignilement\");","map":{"version":3,"sources":["C:/Users/Manoa/Desktop/ionic1/src/pages/InsertSignilement.tsx"],"names":["React","useState","useEffect","useRef","IonHeader","IonPage","IonToolbar","IonTitle","IonContent","IonItem","IonLabel","IonInput","IonButton","IonMenuButton","IonSelect","IonSelectOption","IonTextarea","IonGrid","IonRow","IonCol","IonImg","IonActionSheet","IonFab","IonFabButton","IonIcon","RemoteService","axios","Geolocation","usePhotoGallery","camera","trash","close","InsertSignilement","history","remoteService","error","setError","loginForm","lType","setLType","lon","setLon","Number","lat","setLat","geolocation","photos","takePhoto","deletePhoto","photoToDelete","setPhotoToDelete","tabProblem","setTabProblem","id","region","setRegion","utilisateur","setUtilisateur","sessionStorage","getItem","tokenn","settoken","objet","setObjet","current","Date","datesignalement","setDateSignalement","type","setTypee","protocole","setProtocole","description","setDescription","longitude","setLongitude","latitude","setLatitude","sendGetRequest","url","method","then","Response","data","catch","console","log","getLocation","getCurrentPosition","Resp","coords","Valider","post","res","cp","i","length","b","fetch","webviewPath","blob","push","formData","FormData","append","body","envoyer","e","detail","value","map","photo","index","text","role","icon","handler","undefined","el"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport {\r\n  IonHeader,\r\n  IonPage,\r\n  IonToolbar,\r\n  IonTitle,\r\n  IonContent,\r\n  IonItem,\r\n  IonLabel,\r\n  IonInput,\r\n  IonButton,\r\n  IonText,\r\n  IonMenuButton,\r\n  IonSelect,\r\n  IonSelectOption,\r\n  IonTextarea,\r\n  IonGrid,\r\n  IonRow,\r\n  IonCol,\r\n  IonImg,\r\n  IonActionSheet,\r\n  IonFab,\r\n  IonFabButton,\r\n  IonIcon,\r\n} from \"@ionic/react\";\r\nimport { IUrlOptions } from \"../models/rest-api.model\";\r\nimport { RemoteService } from \"../services/remote.service\";\r\nimport { type } from \"os\";\r\nimport { Method } from \"ionicons/dist/types/stencil-public-runtime\";\r\nimport { setupMaster } from \"cluster\";\r\nimport axios  from 'axios';\r\nimport { Geolocation } from '@capacitor/geolocation';\r\nimport {usePhotoGallery, UserPhoto} from '../hooks/usePhotoGallery';\r\nimport {camera, trash, close} from 'ionicons/icons'\r\nimport { Session } from \"inspector\";\r\n\r\n\r\n// console.log('Current', coordinates);\r\nconst InsertSignilement: React.FC = ({ history }: any) => {\r\n  const remoteService = new RemoteService();\r\n  const [error, setError] = useState({ error: false });\r\n  const loginForm = useRef<HTMLFormElement>(null);\r\n  const [lType,setLType] = useState([]);\r\n  const [lon,setLon]=useState(Number);\r\n  const [lat,setLat]=useState(Number);\r\n  const geolocation  = Geolocation;\r\n  const { photos, takePhoto } = usePhotoGallery();\r\n  const { deletePhoto } = usePhotoGallery();\r\n  const [photoToDelete, setPhotoToDelete] = useState<UserPhoto>();\r\n  const [tabProblem, setTabProblem] = useState([]);\r\n  let id=\"\";\r\n\r\n\r\n  \r\n  const [region,setRegion]= useState(\"null\");\r\n  const [utilisateur,setUtilisateur] = useState(sessionStorage.getItem(\"id\"));\r\n  const [tokenn,settoken] = useState(sessionStorage.getItem(\"Token\"));\r\n  const [objet,setObjet] = useState(\"\");\r\n  const current = new Date();\r\n  const [datesignalement,setDateSignalement] = useState(\"2022-02-25\");\r\n  const [type,setTypee] = useState(\"PRO1\");\r\n  const [protocole,setProtocole] = useState(\"PRO1\");\r\n  const [description,setDescription] = useState(\"\");\r\n  const [longitude,setLongitude] = useState(lon);\r\n  const [latitude,setLatitude] = useState(lat);\r\n  \r\n  \r\n\r\n  // console.log(sessionStorage.getItem(\"id\"));\r\n  const sendGetRequest = async () => {\r\n    return axios({\r\n      url: 'http://localhost:3011/types',\r\n      method: 'GET'\r\n    }).then(Response =>{\r\n      return Response.data;\r\n    }).catch((error) => {\r\n      console.log('Error get type', error)\r\n    })\r\n  };\r\n  useEffect(() => {\r\n    sendGetRequest().then(data => setLType(data));\r\n    \r\n  })\r\n\r\n  const getLocation = () => {\r\n    geolocation.getCurrentPosition().then((Resp) => {\r\n      setLon(Resp.coords.longitude);\r\n      setLat(Resp.coords.latitude);\r\n      console.log(`${Resp.coords.latitude},${Resp.coords.longitude}`);\r\n    }).catch((error) => {\r\n      console.log('No connection default location',error)\r\n      setLon(-18.9860485);\r\n      setLat(47.5324514);\r\n      setLongitude(-18.9860485);\r\n      setLatitude(47.5324514);\r\n    });\r\n    console.log(`${lat},${lon}`);\r\n  }\r\n\r\n\r\n  const Valider = async() => {\r\n    getLocation();\r\n    setLatitude(lat);\r\n    setLongitude(lon);\r\n    id =\"SIG\" +203; //(Math.floor(Math.random() * (5000 - 101 + 1)) + 101).toString();\r\n\r\n    console.log(id+\"-\"+\r\n      type+\"-\"+\r\n      region+\"-\"+\r\n      utilisateur+\"-\"+\r\n      objet+\"-\"+\r\n      datesignalement+\"-\"+\r\n      protocole+\"-\"+\r\n      description+\"-\"+\r\n      longitude+\"-\"+\r\n      latitude);\r\n      axios\r\n      .post(\"http://localhost:3011/signalements/objet/\"+tokenn, {\r\n        id,\r\n        type,\r\n        region,\r\n        utilisateur,\r\n        objet,\r\n        datesignalement,\r\n        protocole,\r\n        description,\r\n        longitude,\r\n        latitude\r\n      })\r\n      .then((res) => {\r\n        // console.log(\"UT\"+(Math.floor(Math.random()*(11 -0 +1))+10).toString())\r\n        // setSuccess(\"inscription terminée\");\r\n        //window.location.href = \"/login\";\r\n      })\r\n      .catch((error) => console.log(error));\r\n      var cp=[];\r\n      for(var i=0;i<photos.length;i++){\r\n        var b=await (await fetch(photos[i].webviewPath!)).blob();\r\n        cp.push(b);\r\n      }\r\n      var formData = new FormData()\r\n      for(var i=0;i<cp.length;i++){\r\n        formData.append('files',cp[i],\"photo.jpeg\");\r\n      }\r\n      var url = \"http://localhost:3011//upload/image\"\r\n        fetch(url, {\r\n          method: 'POST',\r\n          body: formData,\r\n      });\r\n\r\n  }\r\n  const envoyer =async () => {\r\n  //   var cp=[];\r\n  //   for(var i=0;i<photos.length;i++){\r\n  //     var b=await (await fetch(photos[i].webviewPath!)).blob();\r\n  //     cp.push(b);\r\n  //   }\r\n  //   var formData = new FormData()\r\n  //   for(var i=0;i<cp.length;i++){\r\n  //   formData.append('files',cp[i],\"photo.jpeg\");\r\n  //  }\r\n  //   formData.append('problem', prob)\r\n  //   formData.append('description', descri)\r\n  //   formData.append('coordonneX', \"\" + lat)\r\n  //   formData.append('coordonneY', \"\" + long)\r\n\r\n  //   var url = \"http://localhost:6565/api/ajout/signalement/photos/\"+localStorage.getItem('token')\r\n  //   fetch(url, {\r\n  //     method: 'POST',\r\n  //     body: formData,\r\n  //   })\r\n  //     .then((res) => res.json())\r\n  //     .then((result) => {\r\n  //       setMessage(\"Envoye du signalement réussie\");\r\n  //     })\r\n  //     .catch((error) => {\r\n  //       setErreur(\"Echec de l'envoye\");\r\n  //     });\r\n  }\r\n  \r\n\r\n  return (\r\n    <IonPage>\r\n      <IonHeader>\r\n        <IonToolbar>\r\n          <IonMenuButton slot=\"start\"></IonMenuButton>\r\n          <IonTitle>Nouveau signilement</IonTitle>\r\n        </IonToolbar>\r\n      </IonHeader>\r\n\r\n      <IonContent>\r\n        \r\n          <IonItem>\r\n            <IonLabel position=\"floating\">Object</IonLabel>\r\n            <IonInput\r\n              placeholder=\"\"\r\n              type=\"text\"\r\n              name=\"Object\"\r\n              id=\"Object\"\r\n              onIonChange={(e) => setObjet(e.detail.value!)}\r\n            ></IonInput>\r\n          </IonItem>\r\n\r\n          <IonGrid>\r\n            <IonRow>\r\n              {photos.map((photo,index) => (\r\n                <IonCol size=\"6\" key={index}>\r\n                  <IonImg   onClick={() => setPhotoToDelete(photo)} src={photo.webviewPath} />\r\n                </IonCol>\r\n              ))}\r\n              \r\n            </IonRow>\r\n          </IonGrid>\r\n          <IonFab vertical=\"bottom\" horizontal=\"center\" slot=\"fixed\">\r\n          <IonFabButton onClick={() => takePhoto()}>\r\n            <IonIcon icon={camera}></IonIcon>\r\n          </IonFabButton>\r\n        </IonFab>\r\n        <IonActionSheet\r\n          isOpen={!!photoToDelete}\r\n          buttons={[{\r\n            text: 'Delete',\r\n            role: 'destructive',\r\n            icon: trash,\r\n            handler: () => {\r\n              if (photoToDelete) {\r\n                deletePhoto(photoToDelete);\r\n                setPhotoToDelete(undefined);\r\n              }\r\n            }\r\n          }, {\r\n            text: 'Cancel',\r\n            icon: close,\r\n            role: 'cancel'\r\n          }]}\r\n          onDidDismiss={() => setPhotoToDelete(undefined)}\r\n        />\r\n\r\n          <IonItem>\r\n            <IonLabel position=\"floating\">Type</IonLabel>\r\n\r\n            <IonSelect \r\n              placeholder=\"Choisissez le type d'incidents\" \r\n              name=\"type\" \r\n              id=\"type\"  \r\n              onIonChange={(e) => setTypee(e.detail.value!)}\r\n            >\r\n              {\r\n                lType.map((el, index) => {\r\n                  return (<IonSelectOption value={el['id']} key={index} >{el['nom']}</IonSelectOption>);\r\n                })\r\n              }\r\n            </IonSelect>\r\n\r\n          </IonItem>\r\n         \r\n          <IonItem>\r\n            <IonLabel position=\"floating\">description</IonLabel>\r\n            <IonTextarea\r\n              name=\"description\"\r\n              id=\"description\"\r\n              onIonChange={(e) => setDescription(e.detail.value!)}\r\n            ></IonTextarea>\r\n          </IonItem>\r\n          \r\n          <div className=\"button-wrapper\">\r\n          <IonButton expand=\"block\" \r\n            onClick={() => Valider()}\r\n          >\r\n            Valider\r\n          </IonButton>\r\n          </div>\r\n      </IonContent>\r\n    </IonPage>\r\n  );\r\n};\r\n\r\n// export default Details;\r\nexport default InsertSignilement;\r\n"]},"metadata":{},"sourceType":"module"}